local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local parentGui = (gethui and gethui()) or game:GetService("CoreGui")
local HUB_KEY = "hub_live_6812bd621eb9953eee0b5421ad25db77c7fcd9aea475bceb"
 
local SAVE_DIR = "AFKTY"
local SAVE_FILE = "AFKTY/token.txt"

local function getQueue()
	return (syn and syn.queue_on_teleport) or _G.queue_on_teleport or queue_on_teleport or queueteleport or queue_teleport
end
local function queueReexec()
	local q = getQueue()
	if not q then
		return
	end
	local code = ([=[
if not game:IsLoaded() then game.Loaded:Wait() end
repeat task.wait() until game:GetService("Players").LocalPlayer
task.wait(1)
local g = (getgenv and getgenv()) or {}
g.AFKTY_HUB_KEY = "]=] .. HUB_KEY .. [=["
local token = ""
if isfile and readfile and isfile("AFKTY/token.txt") then
	local ok, val = pcall(function() return readfile("AFKTY/token.txt") end)
	if ok and type(val)=="string" then token = (val:gsub("^%s+",""):gsub("%s+$","")):upper() end
end
if token == "" then
	token = g.AFKTY_SAVED_TOKEN or ""
end
local okBody, body = pcall(function() return game:HttpGet("https://raw.githubusercontent.com/alphavalto-svg/AFKTY/refs/heads/main/AFTKYStandalone") end)
if okBody and type(body)=="string" and #body>0 then
	local lf = loadstring(body)
	if lf then
		local okRun, res = pcall(lf)
		local AFKTY = res
		if type(AFKTY)=="function" then
			local okF, resF = pcall(function() return AFKTY() end)
			if okF and type(resF)=="table" then AFKTY = resF end
		end
		if AFKTY then
			local cfg = {
				userToken = token,
				autoReconnect = false,
				heartbeatInterval = 10000,
				hubKey = "]=] .. HUB_KEY .. [=["
			}
			for _, m in ipairs({"Init","Initialize","Connect","Start"}) do
				if AFKTY[m] then
					local ok = pcall(function() AFKTY[m](AFKTY, cfg) end)
					if ok then break end
				end
			end
			if AFKTY.OnConnected and AFKTY.OnConnected.Connect then
				AFKTY.OnConnected:Connect(function()
					pcall(function() AFKTY:SetStatus("Connected") end)
				end)
			end
			if AFKTY.OnDisconnected and AFKTY.OnDisconnected.Connect then
				AFKTY.OnDisconnected:Connect(function()
					pcall(function() AFKTY:SetStatus("Disconnected") end)
					pcall(function() AFKTY:Alert("Disconnected") end)
					pcall(function() AFKTY:Disconnect("Session closed") end)
				end)
			end
		end
	end
end
]=])
	q(code)
end

 
 

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AFKTYStandalone"
ScreenGui.ResetOnSpawn = false
ScreenGui.IgnoreGuiInset = true
do
	if syn and syn.protect_gui then
		syn.protect_gui(ScreenGui)
	end
	ScreenGui.Parent = parentGui
end

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 360, 0, 200)
Frame.Position = UDim2.new(0.5, -180, 0.5, -100)
Frame.BackgroundColor3 = Color3.fromRGB(18, 14, 26)
Frame.BorderSizePixel = 0
Frame.Parent = ScreenGui

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 10)
Corner.Parent = Frame

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -160, 0, 24)
Title.Position = UDim2.new(0, 110, 0, 10)
Title.BackgroundTransparency = 1
Title.Text = "AFKTY Standalone"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.TextColor3 = Color3.fromRGB(200, 160, 255)
Title.Parent = Frame

local DiscordButton = Instance.new("TextButton")
DiscordButton.Size = UDim2.new(0, 90, 0, 24)
DiscordButton.Position = UDim2.new(0, 10, 0, 10)
DiscordButton.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
DiscordButton.TextColor3 = Color3.fromRGB(255, 255, 255)
DiscordButton.Text = "Discord"
DiscordButton.Font = Enum.Font.GothamBold
DiscordButton.TextSize = 14
DiscordButton.TextScaled = false
DiscordButton.AutoButtonColor = true
DiscordButton.TextWrapped = false
DiscordButton.Parent = Frame

local MinButton = Instance.new("TextButton")
MinButton.Size = UDim2.new(0, 30, 0, 24)
MinButton.Position = UDim2.new(1, -40, 0, 10)
MinButton.BackgroundColor3 = Color3.fromRGB(75, 45, 160)
MinButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinButton.Text = "â€”"
MinButton.Font = Enum.Font.GothamBold
MinButton.TextSize = 16
MinButton.AutoButtonColor = true
MinButton.Parent = Frame

local TokenInput = Instance.new("TextBox")
TokenInput.Size = UDim2.new(1, -20, 0, 36)
TokenInput.Position = UDim2.new(0, 10, 0, 44)
TokenInput.BackgroundColor3 = Color3.fromRGB(26, 20, 34)
TokenInput.TextColor3 = Color3.fromRGB(255, 255, 255)
TokenInput.PlaceholderText = "Enter Player Token"
TokenInput.Font = Enum.Font.Gotham
TokenInput.TextSize = 16
TokenInput.ClearTextOnFocus = false
TokenInput.Parent = Frame

local InputCorner = Instance.new("UICorner")
InputCorner.CornerRadius = UDim.new(0, 8)
InputCorner.Parent = TokenInput

local ConnectButton = Instance.new("TextButton")
ConnectButton.Size = UDim2.new(1, -20, 0, 36)
ConnectButton.Position = UDim2.new(0, 10, 0, 90)
ConnectButton.BackgroundColor3 = Color3.fromRGB(110, 70, 220)
ConnectButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ConnectButton.Text = "Connect"
ConnectButton.Font = Enum.Font.GothamBold
ConnectButton.TextSize = 16
ConnectButton.AutoButtonColor = true
ConnectButton.Parent = Frame

local ButtonCorner = Instance.new("UICorner")
ButtonCorner.CornerRadius = UDim.new(0, 8)
ButtonCorner.Parent = ConnectButton

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, -20, 0, 24)
StatusLabel.Position = UDim2.new(0, 10, 0, 132)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = ""
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 14
StatusLabel.TextColor3 = Color3.fromRGB(220, 220, 230)
StatusLabel.Parent = Frame

local CreatorLabel = Instance.new("TextLabel")
CreatorLabel.Size = UDim2.new(0, 220, 0, 18)
CreatorLabel.Position = UDim2.new(0.5, -110, 1, -26)
CreatorLabel.BackgroundTransparency = 1
CreatorLabel.Text = "Creator: Toasty + AlphaValto"
CreatorLabel.Font = Enum.Font.GothamSemibold
CreatorLabel.TextSize = 14
CreatorLabel.TextColor3 = Color3.fromRGB(200, 160, 255)
CreatorLabel.TextXAlignment = Enum.TextXAlignment.Center
CreatorLabel.Parent = Frame

local RestoreButton

local UIS = game:GetService("UserInputService")
local dragging = false
local dragInput
local dragStart
local startPos
local function updateDrag(input)
	local delta = input.Position - dragStart
	Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end
Frame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = Frame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)
Frame.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)
UIS.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		updateDrag(input)
	end
end)

DiscordButton.MouseButton1Click:Connect(function()
	local link = "https://discord.gg/YyWrDqvCzH"
	local ok = false
	if setclipboard then
		local s, e = pcall(function() setclipboard(link) end)
		if s then ok = true end
	end
	if ok then
		pcall(function() game:GetService("StarterGui"):SetCore("SendNotification",{Title="AFKTY",Text="Discord link copied",Duration=2}) end)
	else
		pcall(function() game:GetService("StarterGui"):SetCore("SendNotification",{Title="AFKTY",Text="Link: "..link,Duration=5}) end)
	end
end)

MinButton.MouseButton1Click:Connect(function()
	Frame.Visible = false
	if not RestoreButton then
		RestoreButton = Instance.new("TextButton")
		RestoreButton.Size = UDim2.new(0, 40, 0, 40)
		RestoreButton.Position = UDim2.new(1, -60, 1, -60)
		RestoreButton.BackgroundColor3 = Color3.fromRGB(110, 70, 220)
		RestoreButton.TextColor3 = Color3.fromRGB(255, 255, 255)
		RestoreButton.Text = "AFKTY"
		RestoreButton.Font = Enum.Font.GothamBold
		RestoreButton.TextSize = 12
		RestoreButton.AutoButtonColor = true
		RestoreButton.TextWrapped = true
		RestoreButton.Parent = ScreenGui
		RestoreButton.Draggable = true
		local rc = Instance.new("UICorner")
		rc.CornerRadius = UDim.new(1, 0)
		rc.Parent = RestoreButton
		RestoreButton.MouseButton1Click:Connect(function()
			Frame.Visible = true
			RestoreButton.Visible = false
		end)
	end
	RestoreButton.Visible = true
end)

local AFKTY = nil

local function trim(s)
	return (s:gsub("^%s+", ""):gsub("%s+$", ""))
end

local connecting = false

ConnectButton.MouseButton1Click:Connect(function()
	if connecting then
		return
	end
	local token = trim(TokenInput.Text or "")
	if token == "" then
		StatusLabel.Text = "Please enter your token"
		return
	end
	token = token:upper()
	if #token ~= 6 then
		StatusLabel.Text = "Invalid token format"
		return
	end
	if type(getgenv) == "function" then
		local g = getgenv()
		g.AFKTY_SAVED_TOKEN = token
		g.AFKTY_ORIG_PLACEID = game.PlaceId
	end
	if makefolder and isfolder and not isfolder(SAVE_DIR) then
		pcall(function() makefolder(SAVE_DIR) end)
	end
	if writefile then
		pcall(function() writefile(SAVE_FILE, token) end)
	end

 
	if makefolder and isfolder and not isfolder(SAVE_DIR) then
		pcall(function() makefolder(SAVE_DIR) end)
	end
	if writefile then
		pcall(function() writefile(SAVE_FILE, token) end)
	end
	connecting = true
	ConnectButton.AutoButtonColor = false
	ConnectButton.Text = "Connecting..."
	TokenInput.Active = false
	ConnectButton.Active = false
	local function tryLoadSDK()
		local url = "https://raw.githubusercontent.com/alphavalto-svg/AFKTY/refs/heads/main/AFTKYStandalone"
		if type(loadstring) ~= "function" then
			return nil, "loadstring unavailable"
		end
		local okBody, body = pcall(function() return game:HttpGet(url) end)
		if not okBody or type(body) ~= "string" or #body == 0 then
			return nil, "failed to fetch SDK"
		end
		local lf = loadstring(body)
		if not lf then
			return nil, "failed to compile SDK"
		end
		local okRun, res = pcall(lf)
		if okRun and res ~= nil then
			return res, nil
		end
		return nil, tostring(res)
	end
	local sdkErr
	AFKTY, sdkErr = tryLoadSDK()
	if not AFKTY then
		StatusLabel.Text = "SDK load failed: " .. (sdkErr or "unknown")
		ConnectButton.AutoButtonColor = true
		ConnectButton.Text = "Connect"
		TokenInput.Active = true
		ConnectButton.Active = true
		connecting = false
		return
	end
	if AFKTY.OnConnected and AFKTY.OnConnected.Connect then
		AFKTY.OnConnected:Connect(function()
	StatusLabel.Text = "Connected"
	ConnectButton.Text = "Connected"
	pcall(function() AFKTY:SetStatus("Connected") end)
		end)
	end
	if AFKTY.OnDisconnected and AFKTY.OnDisconnected.Connect then
		AFKTY.OnDisconnected:Connect(function()
			StatusLabel.Text = "Disconnected"
			ConnectButton.Text = "Disconnected"
			pcall(function() AFKTY:SetStatus("Disconnected") end)
			pcall(function() AFKTY:Alert("Disconnected") end)
			pcall(function() AFKTY:Disconnect("Session closed") end)
			connecting = false
			TokenInput.Active = true
			ConnectButton.Active = true
			ConnectButton.AutoButtonColor = true
		end)
	end
	if AFKTY.OnError and AFKTY.OnError.Connect then
		AFKTY.OnError:Connect(function(data)
			local msg = ""
			if typeof(data) == "table" then
				msg = tostring(data.message or data.code or "Error")
			else
				msg = tostring(data)
			end
			StatusLabel.Text = msg
		end)
	end
	if type(AFKTY) == "function" then
		local okf, resf = pcall(function() return AFKTY() end)
		if okf and type(resf) == "table" then
			AFKTY = resf
		end
	end
	local cfg = {
		userToken = token,
		autoReconnect = false,
		heartbeatInterval = 10000,
		hubKey = HUB_KEY
	}
	local errInit = nil
	local okInit = false
	local methods = {"Init","Initialize","Connect","Start"}
	for _, m in ipairs(methods) do
		if AFKTY[m] then
			local ok, err = pcall(function() AFKTY[m](AFKTY, cfg) end)
			if ok then
				okInit = true
				break
			else
				errInit = err
			end
		end
	end
	if not okInit then
		local msg = "Init failed"
		if errInit then
			msg = msg .. ": " .. tostring(errInit)
		end
		if not cfg.hubKey and errInit and tostring(errInit):lower():find("hub") then
			msg = "Hub key required"
		end
		StatusLabel.Text = msg
		ConnectButton.Text = "Connect"
		TokenInput.Active = true
		ConnectButton.Active = true
		ConnectButton.AutoButtonColor = true
		connecting = false
		return
	end
	queueReexec()
end)
spawn(function()
	local fileToken = nil
	if isfile and readfile and isfile(SAVE_FILE) then
		local ok, val = pcall(function() return readfile(SAVE_FILE) end)
		if ok and type(val)=="string" then
			fileToken = (val:gsub("^%s+",""):gsub("%s+$","")):upper()
		end
	end
	if not fileToken and type(getgenv)=="function" then
		local g = getgenv()
		if g and type(g.AFKTY_SAVED_TOKEN)=="string" then
			fileToken = (g.AFKTY_SAVED_TOKEN:gsub("^%s+",""):gsub("%s+$","")):upper()
		end
	end
	if fileToken and #fileToken==6 then
		TokenInput.Text = fileToken

		if not connecting then
			ConnectButton.AutoButtonColor = false
			ConnectButton.Text = "Connecting..."
			TokenInput.Active = false
			ConnectButton.Active = false

			local token = fileToken
			connecting = true
			local function compile(body)
				local lf = loadstring(body)
				if not lf then
					return nil, "failed to compile SDK"
				end
				local ok, res = pcall(lf)
				if ok and res ~= nil then
					return res, nil
				end
				return nil, tostring(res)
			end
			local function tryLoadSDK()
				local url = "https://raw.githubusercontent.com/alphavalto-svg/AFKTY/refs/heads/main/AFTKYStandalone"
				if type(loadstring) ~= "function" then
					return nil, "loadstring unavailable"
				end
				local okBody, body = pcall(function() return game:HttpGet(url) end)
				if not okBody or type(body) ~= "string" or #body == 0 then
					return nil, "failed to fetch SDK"
				end
				local lf = loadstring(body)
				if not lf then
					return nil, "failed to compile SDK"
				end
				local okRun, res = pcall(lf)
				if okRun and res ~= nil then
					return res, nil
				end
				return nil, tostring(res)
			end
			local sdkErr
			AFKTY, sdkErr = tryLoadSDK()
			if not AFKTY then
				StatusLabel.Text = "SDK load failed: " .. (sdkErr or "unknown")
				ConnectButton.AutoButtonColor = true
				ConnectButton.Text = "Connect"
				TokenInput.Active = true
				ConnectButton.Active = true
				connecting = false
				return
			end
			if AFKTY.OnConnected and AFKTY.OnConnected.Connect then
				AFKTY.OnConnected:Connect(function()
					StatusLabel.Text = "Connected"
					ConnectButton.Text = "Connected"
					pcall(function() AFKTY:SetStatus("Connected") end)
				end)
			end
			if AFKTY.OnDisconnected and AFKTY.OnDisconnected.Connect then
				AFKTY.OnDisconnected:Connect(function()
					StatusLabel.Text = "Disconnected"
					ConnectButton.Text = "Disconnected"
					pcall(function() AFKTY:SetStatus("Disconnected") end)
					pcall(function() AFKTY:Alert("Disconnected") end)
					pcall(function() AFKTY:Disconnect("Session closed") end)
					connecting = false
					TokenInput.Active = true
					ConnectButton.Active = true
					ConnectButton.AutoButtonColor = true
				end)
			end
			if type(AFKTY) == "function" then
				local okf, resf = pcall(function() return AFKTY() end)
				if okf and type(resf) == "table" then
					AFKTY = resf
				end
			end
			local cfg = {
				userToken = token,
				autoReconnect = false,
				heartbeatInterval = 10000,
				hubKey = HUB_KEY
			}
			local methods = {"Init","Initialize","Connect","Start"}
			for _, m in ipairs(methods) do
				if AFKTY[m] then
					local ok = pcall(function() AFKTY[m](AFKTY, cfg) end)
					if ok then break end
				end
			end
			queueReexec()
		end
	end
end)
